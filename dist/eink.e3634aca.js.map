{"version":3,"sources":["eink.js"],"names":["debugEl","document","getElementById","debug","msg","value","JSON","stringify","e","log","isKindle","extend","extension","base","fn","prototype","constructor","undefined","Object","create","EInkDataStoreFactory","options","dataStores","getStore","d","path","meta","units","EInkCircularStats","EInkStats","EInkDrawingContext","dataStoreFactory","canvas","themes","displayList","displayPage","page","ctx","getContext","setTheme","theme","setOrientation","portrait","width","height","setAttribute","translate","rotate","Math","PI","setPage","background","clearRect","themeName","update","state","k","i","length","render","EInkUIController","drawingContext","context","rotateControl","pageControl","themeControl","pages","rotation","that","addEventListener","event","EInkUpdater","url","period","max","calculations","enhance","XMLHttpRequest","DONE","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","setInterval","httpRequest","onreadystatechange","readyState","status","start","Date","now","parse","responseText","_ts","getTime","Calcs","save","updateTime","open","send","withStats","currentValue","values","mean","min","stdev","doUpdate","ts","updateValues","v","push","shift","s","n","w","sqrt","call","sinvalues","cosvalues","sin","cos","c","atan2","a","EInkTextBox","pathElements","split","boxSize","labels","x","y","displayUnits","displayPositive","displayNegative","scale","precision","out","data","outmean","outstdev","outmax","outmin","resolve","toDispay","neg","pos","dis","res","toFixed","formatOutput","startDraw","sz","t","l","h","beginPath","fillStyle","fillRect","strokeRect","foreground","strokeStyle","endDraw","dim","twoLineLeft","l1","l2","font","textBaseline","textAlign","fillText","twoLineRight","baseLine","r","txtW","measureText","tl","bl","tr","br","EInkPilot","autoState","heading","EInkLog","trip","EInkFix","navigation","gnss","methodQuality","horizontalDilution","type","satellites","integrity","EInkPossition","toLatitude","lat","NS","floor","m","slice","toLongitude","lon","EW","parseDate","dateStr","regex","exec","ms","date","UTC","toUTCString","position","latitude","longitude","datetime","EInkCurrent","environment","current","drift","set","setTrue","EInkAttitude","attitude","roll","pitch","yaw","EInkRelativeAngle","label","textSize","EInkSpeed","EInkDistance","EInkBearing","EInkTemperature","EInkSys","sys","polarBuild","calcTime","usedJSHeapSize","jsHeapSizeLimit","totalJSHeapSize","EInkRatio"],"mappings":"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","file":"eink.e3634aca.js","sourceRoot":"../src","sourcesContent":["\ntry {\n    var debugEl = document.getElementById(\"debug\");\n    debug = () => {};\n    if ( debugEl ) {\n        debug = (msg) => {\n            if ( typeof msg === 'string') {\n                debugEl.value = debugEl.value+\"\\n\"+msg;\n            } else if ( JSON ) {\n                debugEl.value = debugEl.value+\"\\n\"+JSON.stringify(msg);\n            } else {\n                debugEl.value = debugEl.value+\"\\n\"+msg;\n            }\n        };\n    }\n} catch (e) {\n    document.getElementById(\"debug\").value = document.getElementById(\"debug\").value + \"\\nFailed Fixes\\n\"+e;\n}\nisKindle = (Object.create === undefined);\ndebug(\"Kindle: \"+isKindle);\nfunction log(msg) {\n    if (!isKindle) {\n        //console.log(msg);\n    }\n}\n\n// perform extension of a class\nfunction extend(extension, base ) {\n    for (var fn in base.prototype) {\n        extension.prototype[fn] = base.prototype[fn];\n    }\n    extension.prototype.constructor = extension;\n}\n\nEInkDataStoreFactory = function(options) {\n    this.dataStores = {};\n}\n\nEInkDataStoreFactory.prototype.getStore = function(d, path) {\n    if ( !this.dataStores[path]) {\n        if (d.meta !== undefined && d.meta.units === \"rad\") {\n            this.dataStores[path] = new EInkCircularStats();\n        } else {\n            this.dataStores[path] = new EInkStats();\n        }\n    }\n    return this.dataStores[path];\n};\n\n\nEInkDrawingContext = function(options) {\n    this.dataStoreFactory = new EInkDataStoreFactory();\n    this.canvas = options.canvas;\n    this.themes = options.themes || {};\n    this.displayList = options.displayList;\n    this.displayPage = this.displayList[options.page || \"default\"];\n    this.ctx = canvas.getContext(\"2d\");\n    this.setTheme(options.theme || \"default\");\n    this.setOrientation(options.portrait, options.width || 700, options.height || 580);\n}\n\nEInkDrawingContext.prototype.setOrientation = function(portrait, width, height) {\n    this.width = width || this.width;\n    this.height = height || this.height;\n    if (portrait) {\n        this.canvas.setAttribute(\"width\",this.width+\"px\");\n        this.canvas.setAttribute(\"height\",this.height+\"px\");\n        this.ctx.translate(10,10);\n    } else {\n        this.canvas.setAttribute(\"width\",this.height+\"px\");\n        this.canvas.setAttribute(\"height\",this.width+\"px\");\n        this.ctx.rotate(-Math.PI/2);\n        this.ctx.translate(-this.width+10,10);\n    }    \n}\n\nEInkDrawingContext.prototype.setPage = function(page) {\n    if ( this.displayList[page] ) {\n        this.displayPage = this.displayList[page]; \n        this.canvas.setAttribute(\"style\",\"background-color:\"+this.theme.background);\n        this.ctx.clearRect(-10,-10,this.width+10,this.height+10);\n    }\n}\n\nEInkDrawingContext.prototype.setTheme = function(theme) {\n    if ( this.themeName != theme ) {\n        this.theme = this.themes[theme];\n        this.themeName = theme;\n        this.canvas.setAttribute(\"style\",\"background-color:\"+this.theme.background);\n        this.ctx.clearRect(-10,-10,this.width+10,this.height+10);\n    }\n}\n\nEInkDrawingContext.prototype.update = function(state) {\n    for(var k in this.displayList) {\n        for (var i = 0; i < this.displayList[k].length; i++) {\n            this.displayList[k][i].update(state, this.dataStoreFactory);\n        }\n    }\n    for (var i = 0; i < this.displayPage.length; i++) {\n        this.displayPage[i].render(this.ctx, state, this.theme, this.dataStoreFactory);\n    };\n};\n\n\n\nEInkUIController = function(options) {\n    this.drawingContext = options.context;\n    this.rotateControl = options.rotateControl;\n    this.pageControl = options.pageControl;\n    this.themeControl = options.themeControl;\n    this.pages = options.pages;\n    this.themes = options.themes;\n    this.rotation = false;\n    this.page = 0;\n    this.theme = 0;\n    var that = this;\n    if ( this.rotateControl ) {\n        this.rotateControl.addEventListener(\"click\", function(event) {\n            that.rotation = !that.rotation;\n            that.drawingContext.setOrientation(that.rotation);\n            debug(\"Rotate Click\");\n        });        \n    }\n    if ( this.pageControl ) {\n        this.pageControl.addEventListener(\"click\", function(event) {\n            that.page++;\n            if (that.page === that.pages.length) {\n                that.page = 0;\n            }\n            that.drawingContext.setPage(that.pages[that.page]);\n            debug(\"Page Click\");\n        });        \n    }\n    if ( this.themeControl ) {\n        this.themeControl.addEventListener(\"click\", function(event) {\n            that.theme++;\n            if (that.theme === that.themes.length) {\n                that.theme = 0;\n            }\n            that.drawingContext.setTheme(that.themes[that.theme]);\n            debug(that.themes[that.theme]);\n        });        \n    }\n\n}\n\n\n\nEInkUpdater = function(options) {\n    this.url = options.url;\n    if ( isKindle ) {\n        this.url = this.url+\"?k=1\";\n    }\n    this.period = options.period;\n    if ( isKindle ) {\n        this.period = Math.max(this.period,2000);\n    }\n    this.calculations = options.calculations || {\n        enhance: function() {}\n    };\n    this.context = options.context;\n    if ( ! XMLHttpRequest.DONE ) {\n        XMLHttpRequest.UNSENT = XMLHttpRequest.UNSENT || 0;\n        XMLHttpRequest.OPENED = XMLHttpRequest.OPENED || 1;\n        XMLHttpRequest.HEADERS_RECEIVED = XMLHttpRequest.HEADERS_RECEIVED || 2;\n        XMLHttpRequest.LOADING = XMLHttpRequest.LOADING || 3;\n        XMLHttpRequest.DONE = XMLHttpRequest.DONE || 4;\n    }\n\n    if ( this.period ) {\n        var that = this;\n        debug(this.period);\n        setInterval(function() {\n            try {\n                that.update();\n            } catch (e) {\n                debug(\"error \"+e);\n            }\n        }, this.period);        \n    }\n}\nEInkUpdater.prototype.update = function() {\n    var that = this;\n    var httpRequest = new XMLHttpRequest();\n    httpRequest.onreadystatechange = function() {\n        if (httpRequest.readyState === XMLHttpRequest.DONE) {\n          if (httpRequest.status === 200) {\n            var start = Date.now();\n            var state = JSON.parse(httpRequest.responseText);\n            state._ts = new Date().getTime();\n            Calcs.prototype.save(state, 'sys.updateTime', that.updateTime, new Date(), \"ms\", \"Timetaken to process update\", true);\n            that.calculations.enhance(state);\n            that.context.update(state);\n            that.updateTime = Date.now() - start;\n          }\n        }\n    };\n    httpRequest.open('GET', this.url);\n    httpRequest.send();\n};\n\n\n\n\n// stats classes -------------------------------------\n\nEInkStats = function(options) {\n    this.withStats = true;\n    this._ts = 0;\n    this.currentValue = 0.0;\n    this.values = [];\n    this.mean = 0;\n    this.max = 0;\n    this.min = 0;\n    this.stdev = 0;\n}\n\nEInkStats.prototype.doUpdate = function(state) {\n    if ( !state._ts ) {\n        state._ts = new Date().getTime();\n    }\n    if ( this._ts === state.ts ) {\n        return false;\n    }\n    this._ts = state._ts;\n    return true;\n}\n\nEInkStats.prototype.updateValues = function(v, state) {\n    if (!this.doUpdate(state)) {\n        return;\n    }\n    this.currentValue = v;\n    if ( !this.withStats ) {\n        return;\n    }\n    this.values.push(v);\n    while(this.values.length > 100) {\n        this.values.shift();\n    }\n\n    var s = 0.0;\n    var n = 0.0;\n    for (var i = 0; i < this.values.length; i++) {\n        w = (i+1)/2;\n        s += this.values[i]*w;\n        n += w;\n    }\n    this.mean = s/n;\n    s = 0.0;\n    n = 0.0;\n    for (var i = 0; i < this.values.length; i++) {\n        w = (i+1)/2;\n        s += (this.values[i]-this.mean)*(this.values[i]-this.mean)*w;\n        n += w;\n    }\n    this.stdev = Math.sqrt(s/n);\n\n    this.min = this.mean;\n    this.max = this.mean;\n    for (var i = this.values.length - 1; i >= 0; i--) {\n        this.min = Math.min(this.values[i],this.min);\n    };\n    for (var i = this.values.length - 1; i >= 0; i--) {\n        this.max = Math.max(this.values[i],this.max);\n    };\n}\n\nEInkCircularStats = function(options) {\n    EInkStats.call(this, options);\n    this.sinvalues = [];\n    this.cosvalues = [];\n}\n\nextend(EInkCircularStats, EInkStats);\n\nEInkCircularStats.prototype.updateValues = function(v, state) {\n    if (!this.doUpdate(state)) {\n        return;\n    }    this.currentValue = v;\n    if ( !this.withStats ) {\n        return;\n    }\n    this.values.push(v);\n    while(this.values.length > 100) {\n        this.values.shift();\n    }\n    this.sinvalues.push(Math.sin(v));\n    while(this.sinvalues.length > 100) {\n        this.sinvalues.shift();\n    }\n    this.cosvalues.push(Math.cos(v));\n    while(this.cosvalues.length > 100) {\n        this.cosvalues.shift();\n    }\n    var s = 0.0, c= 0.0;\n    var n = 0.0;\n    for (var i = 0; i < this.values.length; i++) {\n        w = (i+1)/2;\n        s += this.sinvalues[i]*w;\n        c += this.cosvalues[i]*w;\n        n += w;\n    }\n    this.mean = Math.atan2(s/n,c/n);\n\n    // probably not the right way of calculating a SD of a circular\n    // value, however it does produces a viable result.\n    // other methods are estimates.\n    // Not 100% certain about the weighting here.\n    s = 0.0;\n    n = 0.0;\n    for (var i = 0; i < this.values.length; i++) {\n        w = (i+1)/2;\n        a = this.values[i]-this.mean;\n        // find the smallest sweep from the mean.\n        if ( a > Math.PI ) {\n            a = a - 2*Math.PI;\n        } else if ( a < -Math.PI ) {\n            a = a + 2*Math.PI;\n        }\n        s += a*a*w;\n        n += w;\n    }\n    this.stdev = Math.sqrt(s/n);\n    this.min = this.mean;\n    this.max = this.mean;\n    for (var i = this.values.length - 1; i >= 0; i--) {\n        this.min = Math.min(this.values[i],this.min);\n    };\n    for (var i = this.values.length - 1; i >= 0; i--) {\n        this.max = Math.max(this.values[i],this.max);\n    };\n}\n\n// UI classes -------------------------------------\n\n\nEInkTextBox = function(options) {\n    this.options = options;\n    this.path = options.path;\n    this.pathElements = options.path.split(\".\");\n    this.boxSize = options.boxSize || 100;\n    this.labels = options.labels || {};\n    this.x = options.x || 0;\n    this.y = options.y || 0;\n    this.displayUnits = options.displayUnits || \"\";\n    this.displayPositive = options.displayPositive;\n    this.displayNegative = options.displayNegative;\n    this.withStats = (options.withStats===undefined)?true:options.withStats;\n    this.scale = options.scale || 1 ;\n    this.precision = (options.precision ===undefined)?1:options.precision;\n    this.out = \"no data\";\n    this.data = undefined;\n    if ( this.withStats ) {\n        this.outmean = \"-\";\n        this.outstdev = \"-\";\n        this.outmax = \"-\";\n        this.outmin = \"-\";\n    }\n}\nEInkTextBox.prototype.resolve = function(state, path) {\n    var pathElements = this.pathElements;\n    if ( path ) {\n        pathElements = path.split(\".\");\n    }\n    var n = state;\n    for (var i = 0; n && i < pathElements.length; i++) {\n        n = n[pathElements[i]];\n    }\n    return n;\n};\n\n\nEInkTextBox.prototype.toDispay = function(v, precision, displayUnits, neg, pos) {\n    var dis = (displayUnits===undefined)?this.displayUnits:displayUnits;\n    var neg = (neg===undefined)?this.displayNegative:neg;\n    var pos = (pos===undefined)?this.displayPositive:pos;\n    var res = v.toFixed((precision === undefined)?this.precision:precision);\n    if ( neg && res < 0) {\n        res = -res;\n        res = neg+res+dis;\n    } else if ( pos && res > 0) {\n        res = pos+res+dis;\n    } else {\n        res = res+dis;\n    }\n    return res;\n}\n\n\nEInkTextBox.prototype.formatOutput = function(data, scale, precision) {\n    scale = scale || this.scale;\n    if ( !this.withStats) {\n        this.out = this.toDispay(data.currentValue*scale, precision);\n    } else {\n        this.out = this.toDispay(data.currentValue*scale, precision);\n        this.outmax = this.toDispay(data.max*scale, precision);\n        this.outmin = this.toDispay(data.min*scale, precision);\n        this.outmean = \"\\u03BC \"+this.toDispay(data.mean*scale, precision);\n        this.outstdev = \"\\u03C3 \"+this.toDispay(data.stdev*scale, precision, this.displayUnits, \"\",\"\");\n    }\n    return this.out;\n}\n\n\nEInkTextBox.prototype.startDraw = function(ctx, theme) {\n  var sz = this.boxSize;\n  var t = this.y*1.3*sz, l = this.x*2.3*sz,  w = sz*2.2, h= sz*1.2;\n  ctx.translate(l,t); \n  ctx.beginPath();\n  ctx.fillStyle = theme.background;\n  ctx.fillRect(0,0,w,h);\n  ctx.strokeRect(0,0,w,h);\n  ctx.fillStyle = theme.foreground;\n  ctx.strokeStyle = theme.foreground;\n  return {\n    t, l, w, h, sz\n  };\n};\n\nEInkTextBox.prototype.endDraw = function(ctx, dim) {\n  ctx.translate(-dim.l,-dim.t);\n}\n\nEInkTextBox.prototype.twoLineLeft = function(ctx, dim, l1, l2) {\n    ctx.font =  dim.sz/3+\"px arial\";\n    ctx.textBaseline=\"bottom\";\n    ctx.textAlign=\"left\";\n    ctx.fillText(l1, dim.w*0.1,dim.h*0.2+dim.sz/3);\n    ctx.fillText(l2 , dim.w*0.1,dim.h*0.2+2*dim.sz/3);\n\n}\nEInkTextBox.prototype.twoLineRight = function(ctx, dim, l1, l2) {\n    ctx.font =  dim.sz/3+\"px arial\";\n    ctx.textBaseline=\"bottom\";\n    ctx.textAlign=\"right\";\n    ctx.fillText(l1, dim.w*0.95,dim.h*0.2+dim.sz/3);\n    ctx.fillText(l2 , dim.w*0.95,dim.h*0.2+2*dim.sz/3);\n\n}\n\nEInkTextBox.prototype.baseLine = function(ctx, dim, l, r) {\n    ctx.textBaseline=\"bottom\";\n    ctx.font =  (dim.sz/4)+\"px arial\";\n    if ( l ) {\n        ctx.textAlign=\"left\";\n        ctx.fillText(l, dim.w*0.05, dim.h);\n    }\n    if ( r ) {\n        ctx.textAlign=\"right\";\n        ctx.fillText(r, dim.w*0.95, dim.h);        \n    }\n};\n\n\n\nEInkTextBox.prototype.update = function(state, dataStoreFactory) {\n  var d = this.resolve(state);\n  if (!d) {\n    return;\n  }\n  var data = dataStoreFactory.getStore(d, this.path);\n  data.updateValues(d.value, state);\n}\n\nEInkTextBox.prototype.render = function(ctx, state, theme, dataStoreFactory) {\n  var d = this.resolve(state);\n  if (d) {\n    var data = dataStoreFactory.getStore(d, this.path);\n    this.formatOutput(data);\n  }\n\n  var labels = this.labels;\n  var dim = this.startDraw(ctx, theme);\n\n\n  ctx.font =  dim.sz+\"px arial\";\n  ctx.textBaseline=\"bottom\";\n  ctx.textAlign=\"center\";\n  var txtW = ctx.measureText(this.out).width; \n  if ( txtW > (dim.w*0.8) ) {\n      ctx.font =  dim.sz*((dim.w*0.8)/txtW)+\"px arial\";\n      ctx.fillText(this.out, dim.w*0.5,dim.h*0.9);\n  } else {\n      ctx.fillText(this.out, dim.w*0.5,dim.h);\n\n  }\n  if ( labels ) {\n    ctx.font =  (dim.sz/4)+\"px arial\";\n    ctx.textAlign=\"left\";\n    if ( labels.tl  && !this.withStats ) {\n        ctx.fillText(labels.tl, dim.w*0.05, sz/4);\n    }\n    if ( labels.bl ) {\n        ctx.fillText(labels.bl, dim.w*0.05, dim.h);\n    }\n    ctx.textAlign=\"right\";\n    if ( labels.tr  && !this.withStats ) {\n        ctx.fillText(labels.tr, dim.w*0.95, dim.sz/4);\n    }\n    if ( labels.br ) {\n        ctx.fillText(labels.br, dim.w*0.95, dim.h);\n    }\n  }\n  if ( this.withStats ) {\n      ctx.textAlign=\"left\";\n      ctx.fillText(this.outmin, dim.w*0.05,dim.sz/4);\n      ctx.textAlign=\"right\";\n      ctx.fillText(this.outmax, dim.w*0.95,dim.sz/4);\n      ctx.font =  (dim.sz/8)+\"px arial\";\n      ctx.textAlign=\"center\";\n      ctx.fillText(this.outmean, dim.w*0.5,dim.sz/8);\n      ctx.fillText(this.outstdev, dim.w*0.5,dim.sz/4);\n  }\n  this.endDraw(ctx, dim);\n}\n\n\nEInkPilot = function(x, y, boxSize) {\n    var options = {\n        path: \"none\",\n        x: x,\n        y: y,\n        withStats: false,\n        scale: 180/Math.PI,\n        precision: 0,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkPilot, EInkTextBox);\n\nEInkPilot.prototype.update = function( state, dataStoreFactory) {\n    // no action as there are no stats stored centrally.\n    return;\n}\n\n\nEInkPilot.prototype.render = function(ctx, state, theme, dataStoreFactory) {\n    var d = this.resolve(state, \"steering.autopilot.state\");\n    if ( !d ) {\n        return;\n    }\n    var autoState = d.value;\n    var h = this.resolve(state, \"steering.autopilot.target.headingMagnetic\");\n    var heading = \"-\";\n    if ( h ) {\n        heading = this.formatOutput({ currentValue: h.value});\n    }\n\n    var dim = this.startDraw(ctx,theme);\n    ctx.font =  dim.sz+\"px arial\";\n    ctx.textBaseline=\"bottom\";\n    ctx.textAlign=\"center\";\n    ctx.fillText(heading, dim.w*0.5,dim.h);\n\n    this.baseLine(ctx, dim, autoState, \"deg\");\n    ctx.textAlign=\"center\";\n    ctx.fillText(\"pilot\", dim.w*0.5, (dim.sz/4));\n    this.endDraw(ctx, dim);\n};\n\n\n\nEInkLog = function(x,y,boxSize) {\n    var options = {\n        path: \"none\",\n        x: x,\n        y: y,\n        withStats: false,\n        scale: 1/1852,\n        precision: 1,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkLog, EInkTextBox);\n\n\nEInkLog.prototype.update = function( state, dataStoreFactory) {\n    // no action as there are no stats stored centrally.\n    return;\n}\n\n\nEInkLog.prototype.render = function(ctx, state, theme, dataStoreFactory) {\n    // there are 2 paths\n    // navigation.trip.log (m)   distance\n    // navigation.log (m) distance\n\n    var t = this.resolve(state, \"navigation.trip.log\");\n    var l = this.resolve(state, \"navigation.log\");\n    if ( ! (t || l) ) {\n        return;\n    }\n    var trip = \"0.0\";\n    if ( t ) {\n        trip = this.formatOutput({currentValue: t.value},this.scale,2);\n    }\n    var log = \"0.0\";\n    if ( l ) {\n        log = this.formatOutput({currentValue: l.value});\n    }\n    // this will need some adjustment\n    var dim = this.startDraw(ctx,theme);\n\n    this.twoLineLeft(ctx, dim, \"t: \"+trip,\"l: \"+log);\n    this.baseLine(ctx, dim, \"log\",\"Nm\");\n\n    this.endDraw(ctx, dim);\n}\n\n\n\nEInkFix = function(x,y,boxSize) {\n    var options = {\n        path: \"none\",\n        x: x,\n        y: y,\n        withStats: false,\n        scale: 1/1852,\n        precision: 1,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkFix, EInkTextBox);\nEInkFix.prototype.update = function( state, dataStoreFactory) {\n    // no action as there are no stats stored centrally.\n    return;\n}\nEInkFix.prototype.render = function(ctx, state, theme, dataStoreFactory) {\n   /*EInkFix\n   navigation.gnss.methodQuality (text) fix\n   navigation.gnss.horizontalDilution (float) fix\n   navigation.gnss.type (text) fix\n   navigation.gnss.satellites (int) fix\n   navigation.gnss.integrity (text) fix\n    */\n\n    if ( !(state && state.navigation && state.navigation.gnss) ) {\n        return;\n    }\n    var gnss = state.navigation.gnss;\n    var methodQuality = (gnss.methodQuality)?gnss.methodQuality.value:\"-\";\n    var horizontalDilution = (gnss.horizontalDilution)?gnss.horizontalDilution.value:\"-\";\n    var type = (gnss.type)?gnss.type.value:\"-\";\n    var satellites = (gnss.satellites)?gnss.satellites.value:\"-\";\n    var integrity = (gnss.integrity)?gnss.integrity.value:\"-\";\n\n    // this will need some adjustment\n    var dim = this.startDraw(ctx,theme);\n    ctx.font =  dim.sz/6+\"px arial\";\n    ctx.textBaseline=\"bottom\";\n    ctx.textAlign=\"left\";\n    ctx.fillText(methodQuality, dim.w*0.05, dim.sz/4);\n    ctx.fillText(\"sat:\"+satellites, dim.w*0.05,2*dim.sz/4);\n    ctx.fillText(\"hdop:\"+horizontalDilution, dim.w*0.05,3*dim.sz/4);\n    ctx.font =  dim.sz/6+\"px arial\";\n    ctx.fillText(type, dim.w*0.05,dim.sz);\n\n\n    this.endDraw(ctx, dim);\n}\n\nEInkPossition = function(x,y,boxSize) {\n    var options = {\n        path: \"none\",\n        x: x,\n        y: y,\n        withStats: false,\n        scale: 1,\n        precision: 1,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkPossition, EInkTextBox);\nEInkPossition.prototype.update = function( state, dataStoreFactory) {\n    // no action as there are no stats stored centrally.\n    return;\n}\nEInkPossition.prototype.toLatitude = function(lat) {\n    var NS = \"N\"\n    if ( lat < 0 ) {\n        lat = -lat;\n        NS = \"S\";\n    } \n    var d = Math.floor(lat);\n    var m = (60*(lat - d)).toFixed(3);\n    return (\"00\"+d).slice(-2)+\"\\u00B0\"+(\"00\"+m).slice(-6)+\"\\u2032\"+NS;\n}\nEInkPossition.prototype.toLongitude = function(lon) {\n    var EW = \"E\"\n    if ( lon < 0 ) {\n        lon = -lon;\n        EW = \"W\";\n    } \n    var d =  Math.floor(lon);\n    var m = (60*(lon - d)).toFixed(3);\n    return (\"000\"+d).slice(-3)+\"\\u00B0\"+(\"00\"+m).slice(-6)+\"\\u2032\"+EW;\n};\n\nEInkPossition.prototype.parseDate = function(dateStr) {\n    const regex = /(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(.*)Z/gm;\n    let m;\n\n    if ((m = regex.exec(dateStr)) !== null) {\n        var s = Math.floor(m[6]);\n        var ms = m[6]-s;\n        var date = new Date(Date.UTC(m[1],m[2]-1,m[3],m[4],m[5],s,ms));\n        return date.toUTCString();\n    }\n    return dateStr;\n};\n\n\nEInkPossition.prototype.render = function(ctx, state, theme, dataStoreFactory) {\n   /*\n   EInkPossition\n   navigation.position (lat, lon, deg) position\n   navigation.datetime (date)\n    */\n\n    var lat = \"--\\u00B0--.---\\u2032N\", lon = \"---\\u00B0--.---\\u2032W\", ts = \"-\";\n\n    if ( state && state.navigation && state.navigation.position ) {\n        lat = this.toLatitude(state.navigation.position.value.latitude);\n        lon = this.toLongitude(state.navigation.position.value.longitude);\n    }\n    if (state && state.navigation && state.navigation.datetime.value ) {\n        ts = this.parseDate(state.navigation.datetime.value);\n    }\n    // this will need some adjustment\n\n    var dim = this.startDraw(ctx,theme);\n    this.twoLineRight(ctx, dim, lat, lon);\n    ctx.font =  (dim.sz/7)+\"px arial\";\n    ctx.fillText(ts, dim.w*0.95, dim.h*0.95);\n\n\n    this.endDraw(ctx, dim);\n}\n\nEInkCurrent = function(x,y,boxSize) {\n    var options = {\n        path: \"none\",\n        x: x,\n        y: y,\n        withStats: false,\n        scale: 1,\n        precision: 1,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkCurrent, EInkTextBox);\nEInkCurrent.prototype.update = function( state, dataStoreFactory) {\n    // no action as there are no stats stored centrally.\n    return;\n}\nEInkCurrent.prototype.render = function(ctx, state, theme, dataStoreFactory) {\n   /*\n    EInkCurrent\n    environment.current (drift (m/s), setTrue (rad))\n    */\n\n    if ( !(state && state.environment && state.environment.current) ) {\n        return;\n    }\n\n    var drift = this.formatOutput({ currentValue: state.environment.current.value.drift }, 1.943844,1);\n    var set = this.formatOutput({ currentValue: state.environment.current.value.setTrue }, 180/Math.PI,1);\n\n\n\n    // this will need some adjustment\n    var dim = this.startDraw(ctx,theme);\n\n    this.twoLineLeft(ctx, dim,drift+\" Kn\",set+\"\\u00B0T\" );\n    this.baseLine(ctx, dim, \"current\");\n\n    this.endDraw(ctx, dim);\n}\n\n\nEInkAttitude = function(x,y,boxSize) {\n    var options = {\n        path: \"none\",\n        x: x,\n        y: y,\n        withStats: false,\n        scale: 180/Math.PI,\n        precision: 1,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkAttitude, EInkTextBox);\nEInkAttitude.prototype.update = function( state, dataStoreFactory) {\n    // no action as there are no stats stored centrally.\n    return;\n}\nEInkAttitude.prototype.render = function(ctx, state, theme, dataStoreFactory) {\n   /*\n    EInkAttitude\n    navigation.attitude (roll, pitch, yaw rad)\n    */\n\n    if ( !(state && state.navigation && state.navigation.attitude) ) {\n        return;\n    }\n    var attitude = state.navigation.attitude;\n    var roll = this.formatOutput({ currentValue: attitude.value.roll });\n    var pitch = this.formatOutput({ currentValue: attitude.value.pitch });\n    var yaw = this.formatOutput({ currentValue: attitude.value.yaw });\n\n\n\n\n    // this will need some adjustment\n    var dim = this.startDraw(ctx,theme);\n\n    this.twoLineLeft(ctx, dim, \"roll:\"+roll+\"\\u00B0\",\"pitch:\"+pitch+\"\\u00B0\" );\n    this.baseLine(ctx,  dim, \"attitude\", \"deg\")\n\n \n    this.endDraw(ctx, dim);\n}\n\n\n\nEInkRelativeAngle = function(path, label, x, y, boxSize, precision ) {\n    var options = {\n        path: path,\n        labels: {\n            bl: label,\n            br: \"deg\"\n        },\n        x: x,\n        y: y,\n        withStats: true,\n        displayUnits: \"\\u00B0\",\n        displayNegative: \"P\",\n        displayPositive: \"S\",\n        textSize: 3,\n        scale: 180/Math.PI,\n        precision: (precision==undefined)?0:precision,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkRelativeAngle, EInkTextBox);\n\nEInkRelativeAngle.prototype.formatOutput = function(data, scale, precision) {\n    scale = scale || this.scale;\n\n    if ( !this.withStats) {\n        this.out = this.toDispay(data.currentValue*scale, precision);\n    } else {\n        this.out = this.toDispay(data.currentValue*scale, precision);\n        this.outmax = this.toDispay(data.max*scale, precision);\n        this.outmin = this.toDispay(data.min*scale, precision);\n        this.outmean = \"\\u03BC \"+this.toDispay(data.mean*scale, precision);\n        this.outstdev = \"\\u03C3 \"+this.toDispay(data.stdev*scale, 1, this.displayUnits, \"\",\"\");\n    }\n    return this.out;\n}\n\n\n\n\nEInkSpeed = function(path, label, x, y, boxSize, precision) {\n    var options = {\n        path: path,\n        labels: {\n            bl: label,\n            br: \"kn\"\n        },\n        x: x,\n        y: y,\n        withStats: true,\n        scale: 1.943844,\n        precision: (precision==undefined)?1:precision,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkSpeed, EInkTextBox);\n\nEInkDistance = function(path, label, x, y, boxSize, precision) {\n    var options = {\n        path: path,\n        labels: {\n            bl: label,\n            br: \"m\"\n        },\n        x: x,\n        y: y,\n        withStats: true,\n        scale: 1,\n        precision: (precision==undefined)?1:precision,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkDistance, EInkTextBox);\n\nEInkBearing = function(path, label, x, y, boxSize, precision) {\n    var options = {\n        path: path,\n        labels: {\n            bl: label,\n            br: \"deg\"\n        },\n        x: x,\n        y: y,\n        withStats: true,\n        scale: 180/Math.PI,\n        precision: (precision==undefined)?0:precision,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkBearing, EInkTextBox);\n\n// todo\nEInkTemperature = function(path, label, x, y, boxSize, precision) {\n    var options = {\n        path: path,\n        labels: {\n            bl: label,\n            br: \"C\"\n        },\n        x: x,\n        y: y,\n        withStats: true,\n        scale: 1,\n        precision: (precision==undefined)?1:precision,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkTemperature, EInkTextBox);\n\n\nEInkTemperature.prototype.formatOutput = function(data) {\n    if ( !this.withStats) {\n        this.out = this.toDispay(data.currentValue-273.15, this.precision);\n    } else {\n        this.out = this.toDispay(data.currentValue-273.15, this.precision);\n        this.outmax = this.toDispay(data.max-273.15, this.precision);\n        this.outmin = this.toDispay(data.min-273.15, this.precision);\n        this.outmean = \"\\u03BC \"+this.toDispay(data.mean-273.15, this.precision);\n        this.outstdev = \"\\u03C3 \"+this.toDispay(data.stdev, this.precision);            \n    }\n}\n\n// todo\nEInkSys = function(x, y, boxSize) {\n    var options = {\n        path: \"none\",\n        labels: {\n            bl: \"sys\"\n        },\n        x: x,\n        y: y,\n        withStats: false,\n        scale: 1,\n        precision: 0,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkSys, EInkTextBox);\n\nEInkSys.prototype.render = function(ctx, state, theme, dataStoreFactory) {\n\n    if ( !(state && state.sys ) ) {\n        return;\n    }\n    var sys = state.sys;\n    var polarBuild = (sys.polarBuild)?sys.polarBuild.value:\"-\";\n    var calcTime = (sys.calcTime)?sys.calcTime.value:\"-\";\n    var updateTime = (sys.updateTime)?sys.updateTime.value:\"-\";\n    var jsHeapSizeLimit = (sys.jsHeapSizeLimit)?(sys.jsHeapSizeLimit.value/(1024*1024)).toFixed(1):\"-\";\n    var totalJSHeapSize = (sys.totalJSHeapSize)?(sys.totalJSHeapSize.value/(1024*1024)).toFixed(1):\"-\";\n    var usedJSHeapSize = (sys.usedJSHeapSize)?(sys.usedJSHeapSize.value/(1024*1024)).toFixed(1):\"-\";\n\n\n\n    // this will need some adjustment\n    var dim = this.startDraw(ctx,theme);\n\n    ctx.font =  dim.sz/6+\"px arial\";\n    ctx.textBaseline=\"bottom\";\n    ctx.textAlign=\"left\";\n    ctx.fillText(\"init: \"+polarBuild, dim.w*0.05, dim.sz/4);\n    ctx.fillText(\"calc: \"+calcTime, dim.w*0.05,2*dim.sz/4);\n    ctx.fillText(\"up: \"+updateTime, dim.w*0.05,3*dim.sz/4);\n    ctx.fillText(\"mem: \"+usedJSHeapSize, dim.w*0.05,4*dim.sz/4);\n\n\n\n    this.endDraw(ctx, dim);\n}\n\nEInkRatio = function(path, label, x, y, boxSize, precision ) {\n    var options = {\n        path: path,\n        labels: {\n            bl: label,\n            br: \"%\"\n        },\n        x: x,\n        y: y,\n        withStats: true,\n        scale: 100,\n        precision: (precision==undefined)?0:precision,\n        boxSize: boxSize || 100\n    }\n    EInkTextBox.call(this, options);\n}\nextend(EInkRatio, EInkTextBox);\n\nEInkRatio.prototype.formatOutput = function(data, scale, precision) {\n    scale = scale || this.scale;\n\n    if ( !this.withStats) {\n        this.out = this.toDispay(data.currentValue*scale, precision);\n    } else {\n        this.out = this.toDispay(data.currentValue*scale, precision);\n        this.outmax = this.toDispay(data.max*scale, precision);\n        this.outmin = this.toDispay(data.min*scale, precision);\n        this.outmean = \"\\u03BC \"+this.toDispay(data.mean*scale, precision);\n        this.outstdev = \"\\u03C3 \"+this.toDispay(data.stdev*scale, 1, this.displayUnits, \"\",\"\");\n    }\n    return this.out;\n}\n\n\n\n\n\n\n\n"]}