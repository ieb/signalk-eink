{"version":3,"sources":["calcs.js"],"names":["Calcs","options","performance","Performance","prototype","resolveAndCreate","state","path","pathElements","split","n","i","length","undefined","save","v","ts","units","description","overwrite","value","timestamp","meta","calcBearing","truePath","magneticPath","variation","trueBearing","magneticBearing","bearing","Math","PI","enhance","calcStart","Date","now","magneticVariation","navigation","stw","awa","roll","aws","hdt","tws","twa","speedThroughWater","attitude","courseOverGroundMagnetic","courseOverGroundTrue","headingTrue","headingMagnetic","environment","wind","speedApparent","angleApparent","angleTrueWater","speedTrue","leeway","abs","apparentX","cos","apparentY","sin","atan2","sqrt","pow","calcPerformance","polarSpeed","polarSpeedRatio","oppositeTrackMagnetic","oppositeTrackTrue","oppositeHeadingMagnetic","oppositeHeadingTrue","targetTwa","targetStw","targetVmg","vmg","polarVmg","polarVmgRatio","windDirectionTrue","windDirectionMagnetic","fineBuildTime","window","memory","jsHeapSizeLimit","totalJSHeapSize","usedJSHeapSize","pogo1250Polar","name","url","that","DONE","XMLHttpRequest","httpRequest","onreadystatechange","readyState","status","polar","JSON","parse","responseText","_finishLoad","open","send","polarTable","_buildFinePolarTable","polarInput","finePolar","lookup","siunits","twsstep","twastep","startFineBuild","push","ia","is","_calcPolarSpeed","_findIndexes","a","_interpolate","x","xl","xh","yl","yh","r","_fixDirection","d","targets","twsi","twai","stwl","stwh","trueHeading","abs_twa","twal","twah","ttwa","tswt","tvmg","otherTrackHeadingTrue"],"mappings":"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","file":"calcs.ecb52515.js","sourceRoot":"../src","sourcesContent":["/*jshint node:false */\n\n\nCalcs = function(options) {\n    this.performance = new Performance({});\n}\n\n\"use strict\";\n\n\nCalcs.prototype.resolveAndCreate = function(state, path) {\n    var pathElements = path.split(\".\");\n    var n = state;\n    for (var i = 0; i < pathElements.length; i++) {\n        if ( n[pathElements[i]] === undefined ) {\n            n[pathElements[i]] = {};\n        }\n        n = n[pathElements[i]];\n    }\n    return n;\n};\n\nCalcs.prototype.save = function(state, path, v, ts, units, description, overwrite) {\n    var n = this.resolveAndCreate(state, path);\n    if ( overwrite || n.value === undefined ) {\n        n.value = v;\n        n.timestamp = ts;\n        n.meta = { units: units, description: description };\n        n[\"$source\"] = \"calculated\";        \n    }\n};\n\nCalcs.prototype.calcBearing = function(state, truePath, magneticPath, variation) {\n    var trueBearing = this.resolveAndCreate(state, truePath);\n    var magneticBearing = this.resolveAndCreate(state, magneticPath);\n    if ( trueBearing.value && magneticBearing.value === undefined ) {\n        var bearing = trueBearing.value+variation;\n        if (bearing > 2*Math.PI ) {\n            bearing = bearing - 2*Math.PI;\n        } else if ( bearing < 0 ) {\n            bearing = bearing + 2*Math.PI;\n        }\n        magneticBearing.value =  bearing;\n        magneticBearing.timestamp = trueBearing.timestamp;\n        magneticBearing.meta = { units: \"rad\" };\n        magneticBearing[\"$source\"] = \"calculated\";\n    } else if ( magneticBearing.value && trueBearing.value === undefined ) {\n        var bearing = magneticBearing.value-variation;\n        if (bearing > 2*Math.PI ) {\n            bearing = bearing - 2*Math.PI;\n        } else if ( bearing < 0 ) {\n            bearing = bearing + 2*Math.PI;\n        }\n        trueBearing.value =  bearing;\n        trueBearing.timestamp = magneticBearing.timestamp;\n        trueBearing.meta = { units: \"rad\" };\n        trueBearing[\"$source\"] = \"calculated\";\n    }\n};\n\nCalcs.prototype.enhance = function(state) {\n    if ( !state) {\n        return;\n    }\n    var calcStart = Date.now();\n    // true and magnetic\n    var magneticVariation = 0;\n    if (state.navigation && state.navigation.magneticVariation ) {\n        magneticVariation = state.navigation.magneticVariation.value;\n    }\n    this.calcBearing(state, \"navigation.courseOverGroundTrue\", \"navigation.courseOverGroundMagnetic\", magneticVariation);\n    this.calcBearing(state, \"navigation.headingTrue\", \"navigation.headingMagnetic\", magneticVariation);\n\n    var stw = undefined, awa = undefined, roll = undefined, aws = undefined,\n       cogm = undefined, cogt = undefined, hdm = undefined, hdt = undefined,\n       tws = undefined, twa = undefined, timestamp = undefined;\n\n    if ( state.navigation ) {\n        if ( state.navigation.speedThroughWater ) {\n            stw = state.navigation.speedThroughWater.value;\n            timestamp = state.navigation.speedThroughWater.timestamp;\n        }\n        if ( state.navigation.attitude ) {\n            roll = state.navigation.attitude.value.roll;\n        }\n        if ( state.navigation.courseOverGroundMagnetic ) {\n            cogm = state.navigation.courseOverGroundMagnetic.value;\n        }\n        if ( state.navigation.courseOverGroundTrue ) {\n            cogt = state.navigation.courseOverGroundTrue.value;\n        }\n        if ( state.navigation.headingTrue ) {\n            hdt = state.navigation.headingTrue.value;\n        }\n        if ( state.navigation.headingMagnetic ) {\n            hdm = state.navigation.headingMagnetic.value;\n        }\n    }\n    if ( state.environment ) {\n        if (state.environment.wind ) {\n            if (state.environment.wind.speedApparent ){\n                aws = state.environment.wind.speedApparent.value;\n            }\n            if (state.environment.wind.angleApparent ){\n                awa = state.environment.wind.angleApparent.value;\n            }\n            if (state.environment.wind.angleTrueWater ){\n                twa = state.environment.wind.angleTrueWater.value;\n            }\n            if (state.environment.wind.speedTrue ){\n                tws = state.environment.wind.speedTrue.value;\n            }\n        }\n    }\n    var leeway = undefined;\n    if ( stw && roll  && awa && stw) {\n        leeway = 0.0;\n        if ( Math.abs(awa) < Math.PI/2 &&\n             aws < 30/1.943844) {\n            if ( stw > 0.5 ) {\n                  // This comes from Pedrick see http://www.sname.org/HigherLogic/System/DownloadDocumentFile.ashx?DocumentFileKey=5d932796-f926-4262-88f4-aaca17789bb0\n                  // for aws < 30 and awa < 90. UK  =15 for masthead and 5 for fractional\n                leeway = 5 * roll / (stw * stw);\n            }\n        } \n        this.save(state, \"performance.leeway\", leeway, timestamp, \"rad\", \"Leway calulated from roll\", true);\n    }\n    if ( awa && aws && (!twa || !tws)) {\n        var apparentX = Math.cos(awa) * aws;\n        var apparentY = Math.sin(awa) * aws;\n        twa = Math.atan2(apparentY, -stw + apparentX),\n        tws = Math.sqrt(Math.pow(apparentY, 2) + Math.pow(-stw + apparentX, 2));\n\n        this.save(state, \"environment.wind.angleTrueWater\", twa, timestamp, \"rad\", \"True Wind Angle\", false);\n        this.save(state, \"environment.wind.speedTrue\", tws, timestamp, \"rad\", \"True Wind Speed\", false);\n    }\n    if ( tws && twa && stw && hdt ) {\n        var performance = this.performance.calcPerformance(tws, twa, stw, hdt, magneticVariation, leeway);\n        this.save(state, 'performance.polarSpeed', performance.polarSpeed, timestamp, \"m/s\", \"polar speed at this twa\", true);\n        this.save(state, 'performance.polarSpeedRatio', performance.polarSpeedRatio, timestamp, \"%\", \"polar speed ratio\", true);\n        this.save(state, 'performance.oppositeTrackMagnetic', performance.oppositeTrackMagnetic, timestamp, \"rad\", \"opposite track magnetic bearing\", true);\n        this.save(state, 'performance.oppositeTrackTrue', performance.oppositeTrackTrue, timestamp, \"rad\", \"opposite track true bearing\", true);\n        this.save(state, 'performance.oppositeHeadingMagnetic', performance.oppositeHeadingMagnetic, timestamp,  \"rad\", \"opposite geading magnetic bearing\",true);\n        this.save(state, 'performance.oppositeHeadingTrue', performance.oppositeHeadingTrue, timestamp, \"rad\", \"opposite geading true bearing\", true);\n        this.save(state, 'performance.targetTwa', performance.targetTwa, timestamp, \"rad\", \"target twa on this track for best vmg\", true);\n        this.save(state, 'performance.targetStw', performance.targetStw, timestamp, \"m/s\", \"target speed on at best vmg and angle\", true);\n        this.save(state, 'performance.targetVmg', performance.targetVmg, timestamp, \"m/s\", \"target vmg -ve == downwind\", true);\n        this.save(state, 'performance.vmg', performance.vmg, timestamp, \"m/s\", \"current vmg at polar speed\", true);\n        this.save(state, 'performance.polarVmg', performance.polarVmg, timestamp, \"m/s\", \"current vmg at best angle\", true);\n        this.save(state, 'performance.polarVmgRatio', performance.polarVmgRatio, timestamp, \"m/s\", \"ratio between vmg and optimal vmg\", true);\n        this.save(state, 'environment.wind.windDirectionTrue', performance.windDirectionTrue, timestamp, \"rad\",\"True wind direction\", true);\n        this.save(state, 'environment.wind.windDirectionMagnetic', performance.windDirectionMagnetic, timestamp, \"rad\",\"Magnetic wind direction\", true);\n    }\n    this.save(state, 'sys.polarBuild', this.performance.fineBuildTime, timestamp, \"ms\",\"Timetaken to build the Polar Table\", true);\n    this.save(state, 'sys.calcTime', Date.now() - calcStart, timestamp, \"ms\",\"Timetaken perform caculations\", true);\n    if ( window.performance && window.performance.memory  ) {\n        this.save(state, 'sys.jsHeapSizeLimit', window.performance.memory.jsHeapSizeLimit , timestamp, \"bytes\",\"JS Heap Limit\", true);\n        this.save(state, 'sys.totalJSHeapSize', window.performance.memory.totalJSHeapSize , timestamp, \"bytes\",\"JS Heap Size\", true);\n        this.save(state, 'sys.usedJSHeapSize', window.performance.memory.usedJSHeapSize , timestamp, \"bytes\",\"JS Heap Used\", true);\n    }\n}\n\nvar pogo1250Polar = {\n  name : \"pogo1250\",\n  tws : [0,4,6,8,10,12,14,16,20,25,30,35,40,45,50,55,60],\n  twa : [0,5,10,15,20,25,32,36,40,45,52,60,70,80,90,100,110,120,130,140,150,160,170,180],\n  stw : [\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0.4,0.6,0.8,0.9,1,1,1,1.1,1.1,1.1,1.1,0.1,0.1,0.1,0,0],\n[0,0.8,1.2,1.6,1.8,2,2,2.1,2.1,2.2,2.2,2.2,0.5,0.2,0.2,0,0],\n[0,1.2,1.8,2.4,2.7,2.9,3,3.1,3.2,3.3,3.3,3.3,1.2,0.5,0.3,0,0],\n[0,1.4,2.1,2.7,3.1,3.4,3.5,3.6,3.6,3.7,3.8,3.7,1.7,0.7,0.4,0,0],\n[0,1.7,2.5,3.2,3.7,4,4.1,4.3,4.3,4.4,4.5,4.4,2.6,1.1,0.4,0,0],\n[0,2.8,4.2,5.4,6.2,6.7,6.9,7.1,7.2,7.4,7.5,7.4,5.6,2.2,0.7,0,0],\n[0,3.1,4.7,5.9,6.7,7,7.2,7.4,7.6,7.8,7.9,7.9,6.5,2.6,0.8,0,0],\n[0,3.5,5.1,6.3,7,7.3,7.5,7.7,7.9,8.1,8.2,8.3,7.4,2.9,1.2,0,0],\n[0,3.8,5.6,6.7,7.3,7.6,7.8,8,8.2,8.4,8.5,8.6,8.2,3,1.3,0,0],\n[0,4.2,6,7,7.7,8,8.2,8.3,8.6,8.9,9,9.1,8.9,3.2,1.4,0,0],\n[0,4.6,6.3,7.3,8,8.3,8.5,8.7,9,9.3,9.5,9.6,9.6,3.8,1.9,0,0],\n[0,4.8,6.6,7.5,8.2,8.6,8.9,9.1,9.5,9.8,10.1,10.4,10.4,4.2,2.1,0,0],\n[0,5,6.9,7.9,8.3,8.8,9.2,9.4,9.9,10.4,10.9,11.3,11.3,4.5,2.3,0,0],\n[0,5.3,7.1,8.1,8.6,8.9,9.3,9.7,10.4,11.1,11.8,12.5,12.5,5.6,3.1,0.6,0.6],\n[0,5.4,7.1,8.2,8.8,9.2,9.5,9.9,10.9,11.9,12.8,14.1,14.1,7.1,4.2,0.7,0.7],\n[0,5.3,7,8.1,8.8,9.4,9.8,10.3,11.2,12.7,14.3,15,15,8.3,5.3,1.5,1.5],\n[0,5,6.8,7.8,8.6,9.4,10,10.6,11.8,13.2,14.9,15.7,15.7,9.4,6.3,1.6,1.6],\n[0,4.5,6.3,7.4,8.3,9,9.8,10.6,12.3,14.4,15.6,16.6,16.6,10.8,7.5,2.5,2.5],\n[0,3.8,5.6,6.9,7.8,8.5,9.2,10,12.2,15,16.3,17.6,17.6,13.2,9.7,3.5,2.6],\n[0,3.2,4.8,6.1,7.1,7.9,8.6,9.3,10.9,14.4,16.8,18.6,18.6,14.9,11.2,3.7,3.7],\n[0,2.7,4.1,5.3,6.4,7.3,8,8.7,10,12.4,15.4,17.9,17.9,15.2,11.6,4.5,3.6],\n[0,2.4,3.6,4.8,5.9,6.8,7.6,8.2,9.4,11.4,14.3,16.6,16.6,15.8,12.5,5,4.2],\n[0,2.2,3.3,4.4,5.5,6.4,7.2,7.9,9,10.6,12.8,15.4,15.4,15.4,12.3,4.6,3.9]\n]\n};\n\n\n\nPerformance = function(options) {\n    if ( options.url) {\n        var that = this;\n        var DONE = XMLHttpRequest.DONE || 4;\n        var httpRequest = new XMLHttpRequest();\n        httpRequest.onreadystatechange = function() {\n            if (httpRequest.readyState === DONE) {\n              if (httpRequest.status === 200) {\n                var polar = JSON.parse(httpRequest.responseText);\n                that._finishLoad(polar);\n              }\n            }\n        };\n        httpRequest.open('GET', options.url);\n        httpRequest.send();\n    } else {\n        this._finishLoad(pogo1250Polar);\n    }\n\n}\n\nPerformance.prototype._finishLoad = function(polar) {\n    if ( polar.twa.length !== polar.stw.length) {\n      throw(\"Polar STW does not have enough rows for the TWA array. Expected:\"+polar.twa.length+\" Found:\"+polar.stw.length);\n    }\n    for (var i = 0; i < polar.stw.length; i++) {\n      if ( polar.tws.length !== polar.stw[i].length ) {\n            throw(\"Polar STW row \"+i+\" does not ave enough columns Expected:\"+polar.tws.length+\" Found:\"+polar.stw.length);\n      }\n    }\n    for (var i = 1; i < polar.twa.length; i++) {\n      if ( polar.twa[i] < polar.twa[i-1] ) {\n        throw(\"Polar TWA must be in ascending order and match the columns of stw.\");\n      }\n    };\n    for (var i = 1; i < polar.tws.length; i++) {\n      if ( polar.tws[i] < polar.tws[i-1] ) {\n        throw(\"Polar TWA must be in ascending order and match the rows of stw.\");\n      }\n    };\n    // Optimisatin,\n    this.polarTable = this._buildFinePolarTable(polar);\n};\n\nPerformance.prototype._buildFinePolarTable = function(polarInput) {\n    var finePolar = {\n      lookup: true,\n      siunits: true,\n      twsstep : 0.1, // 600 0 - 60Kn\n      twastep : 1,  //  180 0 - 180 deg\n      tws : [],\n      twa : [],\n      stw : []  // 108000 elements\n    }\n    var startFineBuild = Date.now();\n    for(var twa = 0; twa < polarInput.twa[polarInput.twa.length-1]; twa += 1) {\n      finePolar.twa.push(twa*Math.PI/180);\n      finePolar.stw.push([]);\n    }\n    for(var tws = 0; tws < polarInput.tws[polarInput.tws.length-1]; tws += 0.1) {\n      finePolar.tws.push(tws/1.9438444924);\n    }\n    for (var ia = 0; ia < finePolar.twa.length; ia++) {\n      for (var is = 0; is < finePolar.tws.length; is++) {\n        finePolar.stw[ia][is] = this._calcPolarSpeed(polarInput,finePolar.tws[is],finePolar.twa[ia],0);\n      }\n    }\n    this.fineBuildTime = Date.now() - startFineBuild;\n    return finePolar;\n}\n\nPerformance.prototype._findIndexes = function(a, v) {\n    for (var i = 0; i < a.length; i++) {\n        if ( a[i] > v ) {\n            if ( i == 0 ) {\n                return [ 0,0];\n            } else {\n                return [ i-1, i];\n            }\n        }\n    }\n    return [ a.length-1, a.length-1];\n};\n\n/**\n * find y between yl and yh in the same ratio of x between xl, xh\n * simple straight line interpolation.\n */\nPerformance.prototype._interpolate = function(x, xl, xh, yl, yh) {\n  var r = 0;\n  if ( x >= xh ) {\n    r = yh;\n  } else if ( x <= xl ) {\n    r =  yl;\n  } else if ( (xh - xl) < 1.0E-8 ) {\n    r =  yl+(yh-yl)*((x-xl)/1.0E-8);\n  } else {\n    r = yl+(yh-yl)*((x-xl)/(xh-xl));\n  }\n  return r;\n};\n\n\nPerformance.prototype._fixDirection =  function(d) {\n    if ( d > Math.PI*2 ) d = d - Math.PI*2;\n    if ( d < 0 ) d = d + Math.PI*2;\n    return d;\n}\n\nPerformance.prototype._calcPolarSpeed = function(polarInput, tws, twa, stw, targets) {\n    // polar Data is in KN and deg\n    tws = tws*1.9438444924;\n    twa = twa*180/Math.PI;      \n    // after here in Deg and Kn\n    var twsi = this._findIndexes(polarInput.tws, tws);\n    var twai = this._findIndexes(polarInput.twa, twa);\n    var stwl = this._interpolate(twa, polarInput.twa[twai[0]], polarInput.twa[twai[1]], polarInput.stw[twai[0]][twsi[0]], polarInput.stw[twai[1]][twsi[0]]);\n      // interpolate a stw high value for a given tws and range\n    var stwh = this._interpolate(twa, polarInput.twa[twai[0]], polarInput.twa[twai[1]], polarInput.stw[twai[0]][twsi[1]], polarInput.stw[twai[1]][twsi[1]]);\n      // interpolate a stw final value for a given tws and range using the high an low values for twa.\n    return this._interpolate(tws, polarInput.tws[twsi[0]], polarInput.tws[twsi[1]], stwl, stwh)/1.9438444924;      \n}\n\n/**\n * Returns polarPerf = {\n  vmg : 0,\n  polarVmg: 0;\n  polarSpeed: 0,\n  polarSpeedRatio:  1,\n  polarVmgRatio: 1\n }\n Only calcuates polr Vmg ration is targets is defined.\n All inputs outputs are SI\n */\n\nPerformance.prototype.calcPerformance = function(tws, twa, stw, trueHeading, magneticVariation, leeway) {\n    var abs_twa = twa;\n    if ( twa < 0) abs_twa = -twa;\n    var twsi = this._findIndexes(this.polarTable.tws, tws);\n    var twai = this._findIndexes(this.polarTable.twa, abs_twa);\n    var polarSpeed = this.polarTable.stw[twai[1]][twsi[1]];\n    if (polarSpeed !== 0) {\n      polarSpeedRatio = stw/polarSpeed;\n    }\n    var polarVmg = polarSpeed*Math.cos(abs_twa);\n    var vmg = stw*Math.cos(abs_twa);\n\n\n    // calculate the optimal VMG angles\n    var twal = 0;\n    var twah = Math.PI;\n    if ( abs_twa < Math.PI/2 ) {\n      twah = Math.PI/2;\n    } else {\n      twal = Math.PI/2;\n      // downwind scan from 90 - 180\n    }\n    var targetVmg = 0, targetTwa = 0, targetStw = 0;\n    for(var ttwa = twal; ttwa <= twah; ttwa += Math.PI/180) {\n        var twai = this._findIndexes(this.polarTable.twa, ttwa);\n        var tswt = this.polarTable.stw[twai[1]][twsi[1]];\n        var tvmg = tswt*Math.cos(ttwa);\n        if ( Math.abs(tvmg) > Math.abs(targetVmg) ) {\n          targetVmg = tvmg;\n          targetTwa = ttwa;\n          targetStw = tswt;\n        }\n    }\n    if ( twa < 0 ) {\n      targetTwa = -targetTwa;\n    }\n    if (Math.abs(targetVmg) > 1.0E-8 ) {\n       polarVmgRatio = vmg/targetVmg;\n    }\n\n    // calculate other track\n    leeway = leeway || 0;\n\n    var windDirectionTrue = this._fixDirection(trueHeading+twa);\n    var windDirectionMagnetic = this._fixDirection(windDirectionTrue+magneticVariation);\n    otherTrackHeadingTrue = this._fixDirection(windDirectionTrue+targetTwa);\n    if ( twa > 0 ) {\n      oppositeTrackTrue = otherTrackHeadingTrue+leeway*2;\n    } else {\n      oppositeTrackTrue = otherTrackHeadingTrue-leeway*2;\n    }\n    oppositeTrackMagnetic = oppositeTrackTrue + magneticVariation;\n    oppositeHeadingMagnetic = this._fixDirection(otherTrackHeadingTrue + magneticVariation);\n\n    return {\n      vmg: vmg,\n      polarVmg: polarVmg,\n      polarSpeed: polarSpeed,\n      polarSpeedRatio:  polarSpeedRatio,\n      polarVmgRatio: polarVmgRatio,\n      targetVmg: targetVmg,\n      targetTwa: targetTwa,\n      targetStw: targetStw,\n      windDirectionTrue: windDirectionTrue,\n      windDirectionMagnetic: windDirectionMagnetic,\n      oppositeHeadingTrue: otherTrackHeadingTrue,\n      oppositeTrackTrue: oppositeTrackTrue,\n      oppositeTrackMagnetic: oppositeTrackMagnetic,\n      oppositeHeadingMagnetic: oppositeHeadingMagnetic\n    };\n}\n\n\n"]}